<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DETONATE: Text-to-Image Alignment and Kernelized DPO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #ffffff;
      color: #333333;
      scroll-behavior: smooth;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px; 
      margin-left: auto;
      margin-right: auto;
      padding-left: 2rem;
      padding-right: 2rem;
    }
    
    /* Enhanced Header styling with proper title sizing */
    h1 {
      font-size: 4rem; /* Increased from 10rem which was too large */
      font-weight: 800; /* Extra bold for better visibility */
      margin-top: 2rem;
      margin-bottom: 2rem;
      color: #111827; /* Darker color for better contrast */
      text-align: center;
      line-height: 1.1;
      letter-spacing: -0.02em;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    }
    
    .authors {
      text-align: center;
      margin-bottom: 0.75rem;
      font-size: 1.125rem;
      color: #4b5563;
    }
    .authors .author-name {
      color: #007bff;
      text-decoration: none;
      margin: 0 0.375rem;
      font-weight: 500;
    }
    .authors .author-name:hover {
      text-decoration: underline;
    }
    .equal-contrib {
      color: #dc2626;
      font-weight: 500;
      font-size: 0.875rem;
    }
    
    .affiliation {
      text-align: center;
      margin-bottom: 0.5rem;
      font-size: 1rem;
      color: #6b7280;
      font-weight: 400;
    }
    
    .conference-info {
      text-align: center;
      margin-bottom: 2.5rem;
      font-size: 1rem;
      color: #6b7280;
      font-weight: 500;
    }

    /* Button styling */
    .action-buttons {
        text-align: center;
        margin-bottom: 3.5rem;
        display: flex;
        justify-content: center;
        gap: 1rem;
    }
    .action-button {
        display: inline-flex;
        align-items: center;
        padding: 0.625rem 1.5rem;
        border-radius: 0.375rem;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
        border: 1px solid;
        min-width: 110px;
        justify-content: center;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }
    .action-button svg {
        margin-right: 0.375rem;
        width: 1.125rem;
        height: 1.125rem;
    }
    .button-paper {
        background-color: #343a40;
        color: white;
        border-color: #343a40;
    }
    .button-paper:hover {
        background-color: #23272b;
        border-color: #23272b;
    }
    .button-code {
        background-color: #f8f9fa;
        color: #343a40;
        border-color: #ced4da;
    }
    .button-code:hover {
        background-color: #e9ecef;
        border-color: #adb5bd;
    }
    
    /* Navigation Bar */
    nav {
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid #e5e7eb;
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 50;
        margin-bottom: 2rem; 
    }
    nav .container {
        display: flex;
        justify-content: center; 
        align-items: center;
        flex-wrap: wrap; 
    }
    nav a {
        color: #374151;
        text-decoration: none;
        padding: 0.5rem 1rem;
        margin: 0 0.25rem;
        border-radius: 0.375rem;
        font-weight: 500;
        transition: background-color 0.2s ease, color 0.2s ease;
    }
    nav a:hover {
        background-color: #eef2ff;
        color: #3b82f6;
    }

    /* Section styling */
    .section {
      margin-top: 4rem;
      margin-bottom: 4rem;
    }
    .section-title {
      font-size: 2.25rem;
      font-weight: 700;
      color: #1f2937;
      text-align: center;
      margin-bottom: 3rem;
      letter-spacing: -0.025em;
    }
    
    .content-text {
      font-size: 1.125rem;
      color: #374151;
      margin-bottom: 1.5rem;
      text-align: justify;
      line-height: 1.7;
    }
    .content-text strong {
        color: #1f2937;
        font-weight: 600;
    }
    .content-text ul, .content-text ol {
        margin-left: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .content-text li {
        margin-bottom: 0.5rem;
    }
    
    /* Image styling */
    .image-display img {
      max-width: 100%;
      height: auto;
      border-radius: 0.75rem;
      border: 1px solid #e5e7eb;
      margin-left: auto;
      margin-right: auto;
      display: block;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .caption {
      font-size: 1rem;
      color: #6b7280;
      margin-top: 1rem;
      margin-bottom: 2rem;
      text-align: center;
      line-height: 1.5;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Method section styling */
    .method-subsection {
      margin-top: 2.5rem;
      margin-bottom: 2.5rem;
    }
    .method-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
    }
    
    /* Results styling */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    /* Comparison grid */
    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }
    .comparison-item {
        text-align: center;
        background: #f9fafb;
        padding: 1.5rem;
        border-radius: 0.75rem;
        border: 1px solid #e5e7eb;
    }
    .comparison-item img {
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        width: 100%;
        height: auto;
    }
    .comparison-item p {
        font-size: 0.9rem;
        color: #4b5563;
        margin-bottom: 0.5rem;
    }
    .comparison-label {
        font-weight: 600;
        font-size: 1rem;
    }
    .chosen-label {
        color: #059669;
    }
    .rejected-label {
        color: #dc2626;
    }
    
    /* Advisory styling */
    .advisory {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 2px solid #f59e0b;
        color: #92400e;
        padding: 1.5rem 2rem;
        border-radius: 0.75rem;
        text-align: center;
        margin: 3rem 0;
        font-weight: 500;
    }
    .advisory strong {
        font-weight: 700;
        color: #78350f;
    }

    /* BibTeX styling */
    pre {
      background-color: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 1.5rem;
      border-radius: 0.75rem;
      overflow-x: auto;
      font-size: 0.9rem;
      color: #1e293b;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    /* Footer styling */
    .footer {
        text-align: center;
        margin-top: 5rem;
        padding-top: 3rem;
        border-top: 2px solid #e5e7eb;
        font-size: 0.9rem;
        color: #6b7280;
    }
    .author-name-static {
      color: #444;
      font-weight: 500;
      margin: 0 0.375rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        h1 {
            font-size: 2.5rem; /* Adjusted for mobile but still prominent */
            padding: 0 1rem; /* Add padding to prevent text cutoff */
        }
        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .action-buttons {
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        .comparison-grid {
            grid-template-columns: 1fr;
        }
        nav .container {
            justify-content: space-around; 
        }
        nav a {
            padding: 0.5rem 0.5rem; 
            margin: 0.25rem;
            font-size: 0.875rem; 
        }
    }
    
    /* Desktop specific enhancements */
    @media (min-width: 1024px) {
        h1 {
            font-size: 4.5rem; /* Even larger on desktop */
        }
    }
    
    @media (min-width: 1280px) {
        h1 {
            font-size: 5rem; /* Maximum size for very large screens */
        }
    }
/*NEXt and prev code */
 .slider-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .slider-btn {
    background-color: #333;
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    font-size: 1.5rem;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease;
  }

  .slider-btn:hover {
    background-color: #555;
  }

  /* 3D Visualization Containers */
  .viz-3d-container {
    position: relative;
    width: 100%;
    height: 600px;
    margin: 2rem auto;
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .viz-3d-container canvas {
    border-radius: 0.75rem;
  }

  .viz-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 10;
  }

  .viz-control-btn {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .viz-control-btn:hover {
    background: rgba(255, 255, 255, 1);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  .viz-control-btn.active {
    background: #3b82f6;
    color: white;
  }

  .viz-info-overlay {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 12px;
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .plotly-container {
    width: 100%;
    height: 600px;
  }

  /* Animation keyframes */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
    50% { box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3); }
  }

  .viz-3d-container:hover {
    animation: pulse-glow 2s ease-in-out infinite;
  }
  </style>
</head>
<body>

  <div class="container">
    <header class="section">
      <!-- Replace the <h1>...</h1> with your PNG image -->
      <img 
        src="download (14).png" 
        alt="DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization" 
        style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto;" 
      />
      <div class="authors">
        <span class="author-name-static">Renjith Prasad</span><span class="equal-contrib">*</span>,
        <span class="author-name-static">Abhilekh Borah</span><span class="equal-contrib">*</span>,
        <span class="author-name-static">Hasnat Md Abdullah</span><span class="equal-contrib">*</span>,
        <span class="author-name-static">Chathurangi Shyalika,</span>
        <span class="author-name-static">Gurpreet Singh,</span>
        <span class="author-name-static">Ritvik Garimella,</span>
        <span class="author-name-static">Rajarshi Roy,</span>
        <span class="author-name-static">Harshul Surana,</span>
        <span class="author-name-static">Nasrin Imanpour,</span>
        <span class="author-name-static">Suranjana Trivedy,</span>
        <span class="author-name-static">Amit Sheth,</span>
        <span class="author-name-static">Amitava Das</span>
      </div>
      <div class="affiliation">
        AI Institute, University of South Carolina, USA<br>
        <span class="equal-contrib">*: equal contribution</span>
      </div>
      <!-- <div class="conference-info">
        Under Review at the 39th Conference on Neural Information Processing Systems (NeurIPS 2025)
      </div> -->
      <div class="action-buttons">
        <a href="YOUR_PAPER_PDF_LINK_HERE" target="_blank" rel="noopener noreferrer" class="action-button button-paper">
          <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path></svg>
          Paper
        </a>
        <a href="https://github.com/abhilekhborah/Detonate" target="_blank" rel="noopener noreferrer" class="action-button button-code">
          <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 01-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
          Code
        </a>
      </div>
    </header>

    <!-- <nav>
      <div class="container">
        <a href="#abstract">Abstract</a>
        <a href="#introduction">Introduction</a>
        <a href="#benchmark-details">DETONATE Benchmark</a>
        <a href="#method-dpo-kernels">DPO-Kernels</a>
        <a href="#method-aqi">AQI Metric</a>
        <a href="#results-main">Results</a>
        <a href="#visual-examples">Visuals</a>
        <a href="#conclusion">Conclusion</a>
        <a href="#discussion-limitations">Discussion</a>
        <a href="#bibtex">BibTeX</a>
      </div>
    </nav> -->

    <main>
      <section id="teaser" class="section image-display">
        <div class="image-display">
          <img 
            src="download (15).png" 
            alt="DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization" 
            style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
          />
          <p class="caption"><strong>Figure 1: Text-to-Image Alignment under Hateful Prompts: A Visual and Latent Space Comparison across Race, Disability, and Gender Axes. </strong> This figure compares four models: Vanilla SD-XL, SD-XL + DDPO, SAFREE, and SD-XL + DPO-Kernel (Ours), under toxic prompt conditions. Visually (left), DPO-Kernel generates respectful and non-provocative images, neutralizing bias where prior methods fail. For gender prompts, red masks are manually overlaid to indicate nudity missed by other methods. Latently (right), embeddings across Epochs 0, 10, and 20 show that DPO-Kernel achieves clearer separation between hateful and non-hateful samples than DDPO. These results support our core claim: alignment is best achieved through structural regularization in representation space, not post hoc filtering.</p>
        </div>
      </section>

      <section class="advisory">
        <strong>Content Advisory:</strong> This paper includes material that may be disturbing or offensive to some readers, including depictions of violence, sexually explicit imagery, and harmful stereotypes or behaviors.
      </section>

      <section id="abstract" class="section">
        <h2 class="section-title">Abstract</h2>
        <div class="content-text">
          <p style="text-align: justify; color: #555; font-family: sans-serif;">
            Alignment is crucial for text-to-image (T2I) models to ensure that the generated images faithfully capture user intent while maintaining safety and fairness. <strong>Direct Preference Optimization (DPO)</strong> has emerged as a key alignment technique for large language models (LLMs), and its influence is now extending to T2I systems. This paper introduces <strong>DPO-Kernels for T2I models</strong>, a novel extension of DPO that enhances alignment across three key dimensions: (i) <strong>Hybrid Loss</strong>, which integrates embedding-based objectives with the traditional probability-based loss to improve optimization; (ii) <strong>Kernelized Representations</strong>, leveraging <strong>Radial Basis Function (RBF)</strong>, <strong>Polynomial</strong>, and <strong>Wavelet</strong> kernels to enable richer feature transformations, ensuring better separation between safe and unsafe inputs; and (iii) <strong>Divergence Selection</strong>, expanding beyond DPO's default <strong>Kullback–Leibler (KL)</strong> regularizer by incorporating alternative divergence measures such as <strong>Wasserstein</strong> and <strong>Rényi</strong> divergences to enhance stability and robustness in alignment training as shown in Fig. 1. We introduce <strong>DETONATE</strong>, the first large-scale benchmark of its kind, comprising approximately 100K curated image pairs, categorized as <em>chosen</em> and <em>rejected</em>. This benchmark encapsulates three critical axes of social bias and discrimination: <strong>Race</strong>, <strong>Gender</strong>, and <strong>Disability</strong>. The prompts are sourced from the <em>hate speech datasets</em>, while the images are generated using state-of-the-art T2I models, including Stable Diffusion 3.5 Large (SD-3.5), Stable Diffusion XL (SD-XL), and Midjourney. Furthermore, to evaluate alignment beyond surface metrics, we introduce the <strong>Alignment Quality Index (AQI)</strong>: a novel geometric measure that quantifies latent space separability of safe/unsafe image activations, revealing hidden model vulnerabilities. While alignment techniques often risk overfitting, we empirically demonstrate that <strong>DPO-Kernels</strong> preserve strong generalization bounds using the theory of <strong>Heavy-Tailed Self-Regularization (HT-SR)</strong>.
          </p>
        </div>
      </section>

      <section id="benchmark-details" class="section">
        <h2 class="section-title">The DETONATE Benchmark</h2>
        <p class="content-text">We introduce <strong>DETONATE</strong>, a large-scale benchmark designed to stress-test alignment in T2I models through fine-grained, adversarial evaluation. It comprises approximately 25K prompts from English Hate Speech Superset and UCB Hate Speech datasets, focusing on Race, Gender, and Disability. For each prompt, ten diverse images are generated using SoTA models (SD-XL, SD-3.5 Large, Midjourney), from which one chosen (non-hateful) and one rejected (hateful) image are selected via a human-in-the-loop semi-automated technique (LLaVA-family VLMs + human annotators, Cohen's κ=0.86), yielding ~100K curated image pairs.</p>
        <div class="image-display">
          <img 
            src="download (16).png" 
            alt="DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization" 
            style="
              display: block;
              margin: 2rem auto;
              max-width: 1000px;
              width: 100%;
              height: auto;
              border-radius: 0.75rem;
              box-shadow: 0 10px 25px rgba(0,0,0,0.08);
              object-fit: cover;
              object-position: center;
              aspect-ratio: 16 / 9;
              height: 580px; /* Adjust as needed to simulate the trim */
            " 
          />
          <p class="caption"><strong>Figure 2: DETONATE Benchmark Curation Framework.</strong> Illustrating the three-stage pipeline: (i) Collection of hate speech prompts, (ii) Image Generation using T2I models, and (iii) Annotation using VLMs and human verification to form chosen/rejected pairs.</p>
        </div>
      </section>

      <section id="method-dpo-kernels" class="section">
        <h2 class="section-title">DPO-Kernels</h2>
        <p class="content-text">Direct extensions of DPO to T2I diffusion models falter due to reliance on scalar likelihoods, ignoring underlying semantic geometry. We introduce <strong>DPO-Kernels</strong>, a grounded extension of DPO that embeds alignment within the structure of a Reproducing Kernel Hilbert Space (RKHS). Unlike standard DPO, DPO-Kernels leverages kernel methods (Polynomial, RBF, Wavelet) to modulate updates via semantic proximity in embedding space, resulting in a smooth, geometry-aware preference function over latent manifolds. The choice of kernel (Polynomial, RBF, Wavelet) governs the inductive bias, shaping how alignment signals generalize. Polynomial kernels capture global nonlinear interactions. RBF kernels induce local smoothness and semantic clustering. Wavelet kernels combine spatial localization with frequency sensitivity, ideal for T2I alignment where fidelity varies across semantic scales.</p>
        <div class="viz-3d-container" id="kernel-3d-container">
          <div class="viz-controls">
            <button class="viz-control-btn active" onclick="switchKernel('vanilla')">Vanilla DPO</button>
            <button class="viz-control-btn" onclick="switchKernel('polynomial')">Polynomial</button>
            <button class="viz-control-btn" onclick="switchKernel('rbf')">RBF</button>
            <button class="viz-control-btn" onclick="switchKernel('wavelet')">Wavelet</button>
            <button class="viz-control-btn" onclick="toggleRotation()">⏸️ Pause</button>
          </div>
          <div class="viz-info-overlay" id="kernel-info">
            <strong>Vanilla DPO</strong><br>
            Loss Landscape: Standard alignment surface
          </div>
          <div id="kernel-plotly" class="plotly-container"></div>
          <p class="caption"><strong>Figure 3: Interactive 3D Kernel Loss Landscapes.</strong> Experience how Vanilla DPO, Polynomial, RBF, and Wavelet kernels create different alignment surfaces. Use the controls to switch between kernel types and pause/resume the automatic rotation for detailed exploration.</p>
        </div>
        <div class="image-display mt-8">
          <img 
            src="download (17).png" 
            alt="DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization" 
            style="
              display: block;
              margin: 2rem auto;
              max-width: 1000px;
              width: 100%;
              height: auto;
              border-radius: 0.75rem;
              box-shadow: 0 10px 25px rgba(0,0,0,0.08);
              object-fit: cover;
              object-position: center;
              aspect-ratio: 16 / 9;
              height: 480px; /* Adjust as needed to simulate the trim */
            "  
          />
          <p class="caption"><strong>Figure 4:</strong>
            Overview of the proposed DPO-Kernel method applied to diffusion models. The model receives a textual prompt x, a preferred image sample y+, and a non-preferred image sample y−. Through a gradual denoising process, the diffusion model is optimized using a composite gradient objective that combines a kernelized preference score with a diffusion denoising regularizer. This encourages generation of preferred outputs while preserving denoising fidelity.</p>
        </div>
      </section>

      <section id="method-aqi" class="section">
        <h2 class="section-title">Alignment Quality Index (AQI)</h2>
        <p class="content-text">
          Behavioral alignment can be fragile. We propose that true alignment manifests in the model's internal geometry: safe and unsafe inputs should be encoded in representationally distinct ways. The <strong>Alignment Quality Index (AQI)</strong> is a geometry-aware, intrinsic metric evaluating how effectively a model separates safe from unsafe prompts within its latent space. It addresses the blind spot where behavioral safety can coexist with representational misalignment. AQI uses two geometry-based metrics:
        </p>
        <ul class="list-disc list-inside content-text pl-4 space-y-1">
          <li><strong>Davies-Bouldin Score (DBS):</strong> Lower values mean better cluster separation.</li>
          <li><strong>Dunn Index (DI):</strong> Higher values mean better separation and compactness.</li>
        </ul>
        <p class="content-text">
          AQI combines these scores to give a single value: higher AQI means safer and clearer separation in the model's latent space.
        </p>
        <div class="viz-3d-container" id="aqi-3d-container">
          <div class="viz-controls">
            <button class="viz-control-btn active" onclick="switchAQIView('separation')">Cluster Separation</button>
            <button class="viz-control-btn" onclick="switchAQIView('embedding')">Embedding Space</button>
            <button class="viz-control-btn" onclick="switchAQIView('heatmap')">3D Heatmap</button>
            <button class="viz-control-btn" onclick="toggleAQIRotation()">⏸️ Pause</button>
          </div>
          <div class="viz-info-overlay" id="aqi-info">
            <strong>AQI Cluster Separation</strong><br>
            Davies-Bouldin Score: 0.23 | Dunn Index: 2.87
          </div>
          <div id="aqi-plotly" class="plotly-container"></div>
          <p class="caption"><strong>Figure 5: Interactive 3D AQI Visualization.</strong> Explore the Alignment Quality Index through multiple views: cluster separation, embedding space, and 3D heatmaps. The rotating visualization reveals how safe and unsafe samples are separated in the model's latent space.</p>
        </div>
      </section>

      <section id="results-main" class="section">
        <h2 class="section-title">Quantitative Results</h2>
        <div class="image-display mt-6">
          <!-- <div style="text-align: center; padding: 2rem; border: 1px solid #e5e7eb; border-radius: 0.75rem; background-color: #f8fafc;"> -->
             <img 
            src="table 1.png" 
            alt="DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization" 
            style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
          />
          <!-- </div> -->
          <p class="caption"><strong>Table 1: Evaluation of DPO-Kernel Variants against Baselines.</strong> Metrics: Toxicity (↓), CMMD (↓), CLIP Score (↑), AQI (↑). DPO-Kernel (RBF+Rényi) shows superior results.</p>
        </div>
        <div class="viz-3d-container" id="aqi-heatmap-3d-container">
          <div class="viz-controls">
            <button class="viz-control-btn active" onclick="switchHeatmapAxis('race')">Race</button>
            <button class="viz-control-btn" onclick="switchHeatmapAxis('disability')">Disability</button>
            <button class="viz-control-btn" onclick="switchHeatmapAxis('gender')">Gender</button>
            <button class="viz-control-btn" onclick="switchHeatmapAxis('all')">All Axes</button>
            <button class="viz-control-btn" onclick="toggleHeatmapRotation()">⏸️ Pause</button>
          </div>
          <div class="viz-info-overlay" id="heatmap-info">
            <strong>AQI Heatmap - Race Axis</strong><br>
            Alignment Quality Index across different methods
          </div>
          <div id="aqi-heatmap-plotly" class="plotly-container"></div>
        </div>
      </section>

      <section id="visual-examples" class="section">
        <h2 class="section-title">Qualitative Results</h2>
     <div class="image-container max-w-4xl mx-auto">
      <img 
        src="race/HEADER.png" 
        style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem;box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
      />
    </div>
    <div class="slider-container relative max-w-[1080px] mx-auto">
      <button class="slider-btn prev-btn absolute left-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(-1)"><</button>
      <div class="image-container max-w-4xl mx-auto">
        <img 
          id="race-slider-img" 
          src="race/RP1.png" 
          style="display: block; margin: 0.2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
        />
      </div>
      <button class="slider-btn next-btn absolute right-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(1)">></button>
    </div>
     <div class="image-container max-w-4xl mx-auto">
      <img 
        src="Disability/HEADER.png" 
        style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem;box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
      />
    </div>
    <div class="slider-container relative max-w-[1080px] mx-auto">
      <button class="slider-btn prev-btn absolute left-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(-1)"><</button>
      <div class="image-container max-w-4xl mx-auto">
        <img 
          id="disability-slider-img" 
          src="Disability/DP1.png" 
          style="display: block; margin: 0.2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
        />
      </div>
      <button class="slider-btn next-btn absolute right-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(1)">></button>
    </div>
     <div class="image-container max-w-4xl mx-auto">
      <img 
        src="gender/HEADER.png" 
        style="display: block; margin: 2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem;box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
      />
    </div>
    <div class="slider-container relative max-w-[1080px] mx-auto">
      <button class="slider-btn prev-btn absolute left-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(-1)"><</button>
      <div class="image-container max-w-4xl mx-auto">
        <img 
          id="gender-slider-img" 
          src="gender/GP1.png" 
          style="display: block; margin: 0.2rem auto; max-width: 1000px; width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.08);" 
        />
      </div>
      <button class="slider-btn next-btn absolute right-[-48px] top-1/2 -translate-y-1/2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-xl w-12 h-12 rounded-full flex items-center justify-center shadow-lg hover:from-blue-600 hover:to-indigo-700 hover:scale-105 transition-all duration-300" onclick="moveSlide(1)">></button>
    </div>
      </section>
           <section id="bibtex" class="section">
        <h2 class="section-title">BibTeX</h2>
        <pre>
@article{prasad2024detonate,
  title={DETONATE: A Benchmark for Text-to-Image Alignment and Kernelized Direct Preference Optimization},
  author={Prasad, Renjith and Borah, Abhilekh and Abdullah, Hasnat Md and Shyalika, Chathurangi and Singh, Gurpreet and Garimella, Ritvik and Roy, Rajarshi and Surana, Harshul and Imanpour, Nasrin and Trivedy, Suranjana and Sheth, Amit and Das, Amitava},
  journal={arXiv preprint arXiv:XXXX.XXXXX},
  year={2025}
}
        </pre>
        <p class="caption">Please cite our work if you use DETONATE or DPO-Kernels in your research.</p>
      </section>
    </main>
  </div>
<script>
// Configuration for each section
const sliderConfigs = {
  race: { totalSlides: 10, folder: 'race', prefix: 'RP', imgId: 'race-slider-img' },
  disability: { totalSlides: 10, folder: 'Disability', prefix: 'DP', imgId: 'disability-slider-img' },
  gender: { totalSlides: 10, folder: 'gender', prefix: 'GP', imgId: 'gender-slider-img' }
};

// Current index for each section
const currentIndexes = {
  race: 1,
  disability: 1,
  gender: 1
};

function moveSlide(direction) {
  // Find which slider button was clicked
  const clickedButton = event.target;
  const sliderContainer = clickedButton.closest('.slider-container');
  const sliderImg = sliderContainer.querySelector('img');
  
  // Determine section based on the image ID
  let section = '';
  if (sliderImg.id === 'race-slider-img') {
    section = 'race';
  } else if (sliderImg.id === 'disability-slider-img') {
    section = 'disability';
  } else if (sliderImg.id === 'gender-slider-img') {
    section = 'gender';
  }
  
  if (!section) return; // Safety check
  
  const config = sliderConfigs[section];
  
  // Update current index for this section
  currentIndexes[section] += direction;
  if (currentIndexes[section] < 1) currentIndexes[section] = config.totalSlides;
  if (currentIndexes[section] > config.totalSlides) currentIndexes[section] = 1;
  
  // Update image source
  sliderImg.src = `${config.folder}/${config.prefix}${currentIndexes[section]}.png`;
}

// 3D Visualization Variables
let kernelRotationId = null;
let aqiRotationId = null;
let heatmapRotationId = null;
let isKernelRotating = true;
let isAQIRotating = true;
let isHeatmapRotating = true;

// Kernel Loss Landscape Data Generator
function generateKernelData(kernelType) {
  const size = 50;
  const data = [];
  const x = [];
  const y = [];
  const z = [];
  
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
      const xVal = (i - size/2) / 10;
      const yVal = (j - size/2) / 10;
      let zVal = 0;
      
      switch(kernelType) {
        case 'vanilla':
          zVal = Math.exp(-(xVal*xVal + yVal*yVal)/2) + 0.3 * Math.sin(xVal) * Math.cos(yVal);
          break;
        case 'polynomial':
          zVal = Math.pow(1 + xVal*yVal, 3) * Math.exp(-(xVal*xVal + yVal*yVal)/4) + 0.5;
          break;
        case 'rbf':
          zVal = Math.exp(-2*(xVal*xVal + yVal*yVal)) + 0.5 * Math.exp(-((xVal-1)*(xVal-1) + (yVal-1)*(yVal-1))/2);
          break;
        case 'wavelet':
          zVal = Math.cos(Math.sqrt(xVal*xVal + yVal*yVal) * 3) * Math.exp(-(xVal*xVal + yVal*yVal)/3) + 0.2 * Math.sin(xVal*2) * Math.sin(yVal*2);
          break;
      }
      
      x.push(xVal);
      y.push(yVal);
      z.push(zVal);
    }
  }
  
  return { x, y, z };
}

// AQI Data Generator
function generateAQIData(viewType) {
  switch(viewType) {
    case 'separation':
      return generateClusterSeparationData();
    case 'embedding':
      return generateEmbeddingData();
    case 'heatmap':
      return generateAQIHeatmapData();
    default:
      return generateClusterSeparationData();
  }
}

function generateClusterSeparationData() {
  const safePoints = [];
  const unsafePoints = [];
  
  // Generate safe cluster (blue)
  for (let i = 0; i < 100; i++) {
    safePoints.push({
      x: Math.random() * 4 - 2 + 3,
      y: Math.random() * 4 - 2 + 2,
      z: Math.random() * 3 - 1.5 + 1
    });
  }
  
  // Generate unsafe cluster (red)
  for (let i = 0; i < 80; i++) {
    unsafePoints.push({
      x: Math.random() * 3 - 1.5 - 2,
      y: Math.random() * 3 - 1.5 - 1,
      z: Math.random() * 2 - 1 - 1
    });
  }
  
  return { safePoints, unsafePoints };
}

function generateEmbeddingData() {
  const points = [];
  const colors = [];
  
  for (let i = 0; i < 200; i++) {
    const angle = (i / 200) * Math.PI * 4;
    const radius = 3 + Math.sin(angle * 3) * 1.5;
    points.push({
      x: radius * Math.cos(angle) + (Math.random() - 0.5) * 0.5,
      y: radius * Math.sin(angle) + (Math.random() - 0.5) * 0.5,
      z: Math.sin(angle * 2) * 2 + (Math.random() - 0.5) * 0.3
    });
    colors.push(i < 100 ? 'Safe' : 'Unsafe');
  }
  
  return { points, colors };
}

function generateAQIHeatmapData() {
  const methods = ['Vanilla DPO', 'DPO-Kernel (Poly)', 'DPO-Kernel (RBF)', 'DPO-Kernel (Wavelet)', 'DDPO', 'SAFREE'];
  const metrics = ['Davies-Bouldin', 'Dunn Index', 'Silhouette', 'Calinski-Harabasz'];
  const axes = ['Race', 'Gender', 'Disability'];
  
  const data = [];
  
  for (let i = 0; i < methods.length; i++) {
    for (let j = 0; j < metrics.length; j++) {
      for (let k = 0; k < axes.length; k++) {
        const value = Math.random() * 0.8 + 0.2 + (i === 2 ? 0.3 : 0); // RBF performs better
        data.push({
          method: methods[i],
          metric: metrics[j],
          axis: axes[k],
          value: value,
          x: i,
          y: j,
          z: k
        });
      }
    }
  }
  
  return data;
}

// Initialize Kernel Visualization
function initKernelVisualization() {
  const kernelData = generateKernelData('vanilla');
  
  const trace = {
    x: kernelData.x,
    y: kernelData.y,
    z: kernelData.z,
    type: 'scatter3d',
    mode: 'markers',
    marker: {
      size: 3,
      color: kernelData.z,
      colorscale: 'Viridis',
      showscale: true,
      colorbar: {
        title: 'Loss Value',
        thickness: 15,
        len: 0.7
      }
    },
    hovertemplate: '<b>Loss Landscape</b><br>X: %{x:.2f}<br>Y: %{y:.2f}<br>Loss: %{z:.2f}<extra></extra>'
  };
  
  const layout = {
    scene: {
      xaxis: { title: 'Semantic Dimension 1' },
      yaxis: { title: 'Semantic Dimension 2' },
      zaxis: { title: 'Loss Value' },
      camera: {
        eye: { x: 1.5, y: 1.5, z: 1.5 }
      },
      bgcolor: 'rgba(0,0,0,0)',
    },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    margin: { l: 0, r: 0, t: 0, b: 0 },
    showlegend: false
  };
  
  const config = {
    responsive: true,
    displayModeBar: false
  };
  
  Plotly.newPlot('kernel-plotly', [trace], layout, config);
  
  // Start rotation
  startKernelRotation();
}

// Initialize AQI Visualization
function initAQIVisualization() {
  const aqiData = generateAQIData('separation');
  
  const safeTrace = {
    x: aqiData.safePoints.map(p => p.x),
    y: aqiData.safePoints.map(p => p.y),
    z: aqiData.safePoints.map(p => p.z),
    type: 'scatter3d',
    mode: 'markers',
    name: 'Safe Samples',
    marker: {
      size: 6,
      color: '#3b82f6',
      opacity: 0.8
    },
    hovertemplate: '<b>Safe Sample</b><br>X: %{x:.2f}<br>Y: %{y:.2f}<br>Z: %{z:.2f}<extra></extra>'
  };
  
  const unsafeTrace = {
    x: aqiData.unsafePoints.map(p => p.x),
    y: aqiData.unsafePoints.map(p => p.y),
    z: aqiData.unsafePoints.map(p => p.z),
    type: 'scatter3d',
    mode: 'markers',
    name: 'Unsafe Samples',
    marker: {
      size: 6,
      color: '#ef4444',
      opacity: 0.8
    },
    hovertemplate: '<b>Unsafe Sample</b><br>X: %{x:.2f}<br>Y: %{y:.2f}<br>Z: %{z:.2f}<extra></extra>'
  };
  
  const layout = {
    scene: {
      xaxis: { title: 'Embedding Dimension 1' },
      yaxis: { title: 'Embedding Dimension 2' },
      zaxis: { title: 'Embedding Dimension 3' },
      camera: {
        eye: { x: 1.8, y: 1.8, z: 1.2 }
      },
      bgcolor: 'rgba(0,0,0,0)',
    },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    margin: { l: 0, r: 0, t: 0, b: 0 },
    legend: {
      x: 0.02,
      y: 0.98,
      bgcolor: 'rgba(255,255,255,0.8)',
      bordercolor: 'rgba(0,0,0,0.2)',
      borderwidth: 1
    }
  };
  
  const config = {
    responsive: true,
    displayModeBar: false
  };
  
  Plotly.newPlot('aqi-plotly', [safeTrace, unsafeTrace], layout, config);
  
  // Start rotation
  startAQIRotation();
}

// Initialize AQI Heatmap Visualization
function initAQIHeatmapVisualization() {
  const heatmapData = generateAQIHeatmapData();
  
  const trace = {
    x: heatmapData.map(d => d.x),
    y: heatmapData.map(d => d.y),
    z: heatmapData.map(d => d.z),
    type: 'scatter3d',
    mode: 'markers',
    marker: {
      size: heatmapData.map(d => d.value * 15 + 5),
      color: heatmapData.map(d => d.value),
      colorscale: 'RdYlBu_r',
      showscale: true,
      colorbar: {
        title: 'AQI Score',
        thickness: 15,
        len: 0.7
      },
      opacity: 0.8
    },
    text: heatmapData.map(d => `${d.method}<br>${d.metric}<br>${d.axis}<br>AQI: ${d.value.toFixed(3)}`),
    hovertemplate: '%{text}<extra></extra>'
  };
  
  const layout = {
    scene: {
      xaxis: { 
        title: 'Method',
        tickvals: [0, 1, 2, 3, 4, 5],
        ticktext: ['Vanilla DPO', 'Poly', 'RBF', 'Wavelet', 'DDPO', 'SAFREE']
      },
      yaxis: { 
        title: 'Metric',
        tickvals: [0, 1, 2, 3],
        ticktext: ['Davies-Bouldin', 'Dunn Index', 'Silhouette', 'Calinski-Harabasz']
      },
      zaxis: { 
        title: 'Bias Axis',
        tickvals: [0, 1, 2],
        ticktext: ['Race', 'Gender', 'Disability']
      },
      camera: {
        eye: { x: 2, y: 2, z: 1.5 }
      },
      bgcolor: 'rgba(0,0,0,0)',
    },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    margin: { l: 0, r: 0, t: 0, b: 0 },
    showlegend: false
  };
  
  const config = {
    responsive: true,
    displayModeBar: false
  };
  
  Plotly.newPlot('aqi-heatmap-plotly', [trace], layout, config);
  
  // Start rotation
  startHeatmapRotation();
}

// Rotation Functions
function startKernelRotation() {
  if (!isKernelRotating) return;
  
  let angle = 0;
  kernelRotationId = setInterval(() => {
    if (!isKernelRotating) return;
    
    angle += 1;
    const camera = {
      eye: {
        x: 2.5 * Math.cos(angle * Math.PI / 180),
        y: 2.5 * Math.sin(angle * Math.PI / 180),
        z: 1.5 + 0.5 * Math.sin(angle * Math.PI / 90)
      }
    };
    
    Plotly.relayout('kernel-plotly', {'scene.camera': camera});
  }, 50);
}

function startAQIRotation() {
  if (!isAQIRotating) return;
  
  let angle = 0;
  aqiRotationId = setInterval(() => {
    if (!isAQIRotating) return;
    
    angle += 0.8;
    const camera = {
      eye: {
        x: 2.2 * Math.cos(angle * Math.PI / 180),
        y: 2.2 * Math.sin(angle * Math.PI / 180),
        z: 1.5 + 0.3 * Math.cos(angle * Math.PI / 120)
      }
    };
    
    Plotly.relayout('aqi-plotly', {'scene.camera': camera});
  }, 60);
}

function startHeatmapRotation() {
  if (!isHeatmapRotating) return;
  
  let angle = 0;
  heatmapRotationId = setInterval(() => {
    if (!isHeatmapRotating) return;
    
    angle += 0.6;
    const camera = {
      eye: {
        x: 2.8 * Math.cos(angle * Math.PI / 180),
        y: 2.8 * Math.sin(angle * Math.PI / 180),
        z: 2 + 0.4 * Math.sin(angle * Math.PI / 100)
      }
    };
    
    Plotly.relayout('aqi-heatmap-plotly', {'scene.camera': camera});
  }, 70);
}

// Control Functions
function switchKernel(kernelType) {
  // Update button states
  document.querySelectorAll('#kernel-3d-container .viz-control-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update info overlay
  const infoTexts = {
    vanilla: { title: 'Vanilla DPO', desc: 'Loss Landscape: Standard alignment surface' },
    polynomial: { title: 'Polynomial Kernel', desc: 'Loss Landscape: Global nonlinear interactions' },
    rbf: { title: 'RBF Kernel', desc: 'Loss Landscape: Local smoothness and clustering' },
    wavelet: { title: 'Wavelet Kernel', desc: 'Loss Landscape: Spatial-frequency sensitivity' }
  };
  
  const info = infoTexts[kernelType];
  document.getElementById('kernel-info').innerHTML = `<strong>${info.title}</strong><br>${info.desc}`;
  
  // Generate new data and update plot
  const kernelData = generateKernelData(kernelType);
  
  const update = {
    x: [kernelData.x],
    y: [kernelData.y],
    z: [kernelData.z],
    'marker.color': [kernelData.z]
  };
  
  Plotly.restyle('kernel-plotly', update, [0]);
}

function switchAQIView(viewType) {
  // Update button states
  document.querySelectorAll('#aqi-3d-container .viz-control-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update info overlay
  const infoTexts = {
    separation: { title: 'AQI Cluster Separation', desc: 'Davies-Bouldin Score: 0.23 | Dunn Index: 2.87' },
    embedding: { title: 'AQI Embedding Space', desc: 'Semantic embedding visualization' },
    heatmap: { title: 'AQI 3D Heatmap', desc: 'Multi-dimensional alignment quality' }
  };
  
  const info = infoTexts[viewType];
  document.getElementById('aqi-info').innerHTML = `<strong>${info.title}</strong><br>${info.desc}`;
  
  // Generate new data based on view type
  if (viewType === 'embedding') {
    const embeddingData = generateEmbeddingData();
    
    const safeTrace = {
      x: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Safe').map(p => p.x),
      y: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Safe').map(p => p.y),
      z: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Safe').map(p => p.z),
      type: 'scatter3d',
      mode: 'markers',
      name: 'Safe Embeddings',
      marker: { size: 5, color: '#10b981', opacity: 0.7 }
    };
    
    const unsafeTrace = {
      x: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Unsafe').map(p => p.x),
      y: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Unsafe').map(p => p.y),
      z: embeddingData.points.filter((_, i) => embeddingData.colors[i] === 'Unsafe').map(p => p.z),
      type: 'scatter3d',
      mode: 'markers',
      name: 'Unsafe Embeddings',
      marker: { size: 5, color: '#f59e0b', opacity: 0.7 }
    };
    
    Plotly.react('aqi-plotly', [safeTrace, unsafeTrace]);
  } else {
    // Switch back to original separation view
    const aqiData = generateAQIData('separation');
    
    const safeTrace = {
      x: aqiData.safePoints.map(p => p.x),
      y: aqiData.safePoints.map(p => p.y),
      z: aqiData.safePoints.map(p => p.z),
      type: 'scatter3d',
      mode: 'markers',
      name: 'Safe Samples',
      marker: { size: 6, color: '#3b82f6', opacity: 0.8 }
    };
    
    const unsafeTrace = {
      x: aqiData.unsafePoints.map(p => p.x),
      y: aqiData.unsafePoints.map(p => p.y),
      z: aqiData.unsafePoints.map(p => p.z),
      type: 'scatter3d',
      mode: 'markers',
      name: 'Unsafe Samples',
      marker: { size: 6, color: '#ef4444', opacity: 0.8 }
    };
    
    Plotly.react('aqi-plotly', [safeTrace, unsafeTrace]);
  }
}

function toggleRotation() {
  isKernelRotating = !isKernelRotating;
  const btn = event.target;
  
  if (isKernelRotating) {
    btn.innerHTML = '⏸️ Pause';
    startKernelRotation();
  } else {
    btn.innerHTML = '▶️ Play';
    if (kernelRotationId) {
      clearInterval(kernelRotationId);
      kernelRotationId = null;
    }
  }
}

function toggleAQIRotation() {
  isAQIRotating = !isAQIRotating;
  const btn = event.target;
  
  if (isAQIRotating) {
    btn.innerHTML = '⏸️ Pause';
    startAQIRotation();
  } else {
    btn.innerHTML = '▶️ Play';
    if (aqiRotationId) {
      clearInterval(aqiRotationId);
      aqiRotationId = null;
    }
  }
}

function toggleHeatmapRotation() {
  isHeatmapRotating = !isHeatmapRotating;
  const btn = event.target;
  
  if (isHeatmapRotating) {
    btn.innerHTML = '⏸️ Pause';
    startHeatmapRotation();
  } else {
    btn.innerHTML = '▶️ Play';
    if (heatmapRotationId) {
      clearInterval(heatmapRotationId);
      heatmapRotationId = null;
    }
  }
}

function switchHeatmapAxis(axis) {
  // Update button states
  document.querySelectorAll('#aqi-heatmap-3d-container .viz-control-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update info overlay
  const infoTexts = {
    race: 'AQI Heatmap - Race Axis',
    disability: 'AQI Heatmap - Disability Axis',
    gender: 'AQI Heatmap - Gender Axis',
    all: 'AQI Heatmap - All Axes'
  };
  
  document.getElementById('heatmap-info').innerHTML = `<strong>${infoTexts[axis]}</strong><br>Alignment Quality Index across different methods`;
  
  // Generate filtered data based on axis
  let filteredData = generateAQIHeatmapData();
  if (axis !== 'all') {
    const axisMap = { race: 'Race', disability: 'Disability', gender: 'Gender' };
    filteredData = filteredData.filter(d => d.axis === axisMap[axis]);
  }
  
  const update = {
    x: [filteredData.map(d => d.x)],
    y: [filteredData.map(d => d.y)],
    z: [filteredData.map(d => d.z)],
    'marker.size': [filteredData.map(d => d.value * 15 + 5)],
    'marker.color': [filteredData.map(d => d.value)],
    text: [filteredData.map(d => `${d.method}<br>${d.metric}<br>${d.axis}<br>AQI: ${d.value.toFixed(3)}`)]
  };
  
  Plotly.restyle('aqi-heatmap-plotly', update, [0]);
}

// Initialize all 3D visualizations when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Add a small delay to ensure Plotly is fully loaded
  setTimeout(() => {
    initKernelVisualization();
    initAQIVisualization();
    initAQIHeatmapVisualization();
  }, 500);
});

// Clean up intervals when page unloads
window.addEventListener('beforeunload', function() {
  if (kernelRotationId) clearInterval(kernelRotationId);
  if (aqiRotationId) clearInterval(aqiRotationId);
  if (heatmapRotationId) clearInterval(heatmapRotationId);
});
</script>
</body>
</html>